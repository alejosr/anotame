<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Notasapp</title>
    <link rel='stylesheet' href='assets/font/OpenSans.css' />
    <link rel='stylesheet' href='assets/css/style.min.css' />

    <link rel="import" href="assets/html/about.html" />
    <link rel="import" href="assets/html/editor.html" />
  </head>
  <body>
    <div id="content" class="content">
        <div id="leftbar">
            <div id="list-title">
                <span>x</span>
            </div>
            <div id="list-content">

            </div>
        </div>
        <div id="main">
        </div>
    </div>
    <script>
        require('./assets/lib/imports');
        window.$ = window.jQuery = require('./assets/lib/jquery');
        require('./app/const');
        // require('./app/NotasFront');

        function nf_listhtml(list, rama){
            let html = (rama>0) ? "<ul style='display:none'>" : "<ul>";

            list.forEach(function(v,i){
                if(v.type==0){
                    html+=`<li class='file' onclick='mostrar_archivo("${v.path}")'>${v.name}</li>`;
                }else{
                    html+=`<li class='book' onclick='mostrar_hijos(this)'><b>${v.name}</b>` + nf_listhtml(v.content, rama+1) + `</li>`;
                }
            });
            html+="</ul>";
            return html;
        }

        function nf_refresh(list){
            console.log(list)
            let html = nf_listhtml(list,0);
            $("#list-content").empty().append(html);
        }

        function mostrar_hijos(self){
            $(self).find("ul").first().toggle();
        }

        function mostrar_archivo(path){
            $("#editor").hide();
            $("#ed_content").html("Hola Mundo")
            $("#ed_info").html(path);
            $("#editor").show();
        }

        const {ipcRenderer} = require('electron')
        ipcRenderer.send('dom-is-ready');

        ipcRenderer.on('close-about', function(event, input, output) {
            document.getElementById('about').style.display = "none";
        });

        ipcRenderer.on('close-window', function(event, input, output) {
            ipcRenderer.send('dom-hide-window');
        });

        ipcRenderer.on('open-window', function(event, input, output) {
            switch( input.action ){
                case 'list':
                        let list = input.parameters;
                        nf_refresh(list);
                    break;
                case 'about':
                        let version = input.parameters;
                        document.getElementById('app_version').innerHTML = version;
                        document.getElementById('about').style.display = "block";
                    break;
                default:
                    break;
            }

            ipcRenderer.send('dom-show-window');
        });

        document.getElementById("btn_close_about").addEventListener("click", function (e) {
            document.getElementById('about').style.display = "none";
            //window.close();
        });
    </script>
  </body>
</html>
